var F={equal:"eq",notEqual:"ne",lessThan:"lt",greaterThan:"gt",lessOrEqual:"lte",greaterOrEqual:"gte",include:"in",notInclude:"nin"},x={UPLOAD:"upload",FETCH:"fetch",PRIVATE:"private",AUTHENTICATED:"authenticated",SPRITE:"sprite",FACEBOOK:"facebook",TWITTER:"twitter",YOUTUBE:"youtube",VIMEO:"vimeo",MULTI:"multi",INSTAGRAM:"instagram",HULU:"hulu",ANIMOTO:"animoto",DAILYMOTION:"dailymotion"},h={IMAGE:"image",VIDEO:"video",RAW:"raw"},M={context:"ctx",structureMetadata:"md"},_={"image/upload":"images","image/private":"private_images","image/authenticated":"authenticated_images","raw/upload":"files","video/upload":"videos"},B={angle:"a",rotate:"a",background:"b",color:"co",colorSpace:"cs",customFunction:"fn",defaultImage:"d",density:"dn",dpr:"dpr",opacity:"o",format:"f",gravity:"g",overlay:"l",page:"pg",prefix:"p",quality:"q",radius:"r",bitRate:"br",keyframeInterval:"ki",audioCodec:"ac",audioFrequency:"af",delay:"dl",ocr:"ocr",streamingProfile:"sp",transformation:"t",underlay:"u",videoCodec:"vc",videoSampling:"vs",zoom:"z"},z={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"lte",">=":"gte","&&":"and","||":"or","*":"mul","/":"div","+":"add","-":"sub","^":"pow"},P={width:"w",height:"h",x:"x",y:"y",quality:"q",if:"if",aspectRatio:"ar",rotate:"a",opacity:"o",radius:"r",dpr:"dpr",effect:"e",border:"bo",currentPage:"cp",preview:"preview:duration",duration:"du",faceCount:"fc",initialAspectRatio:"iar",initialDuration:"idu",initialHeight:"ih",initialWidth:"iw",pageCount:"pc",pageX:"px",pageY:"py",tags:"tags"},G="("+Object.keys(P).join("|")+")",L=["quality","if","rotate","zoom","opacity","radius","effect","dpr"],Y={width:"w",initialWidth:"iw",height:"h",initialHeight:"ih",aspectRatio:"ar",intialAspectRatio:"iar",context:"ctx",metadata:"md",tags:"tags",trimmedAspectRatio:"tar",currentPage:"cp",faceCount:"fc",pageCount:"pc",pageXOffset:"px",pageYOffset:"py",initialDensity:"idn",illustration:"ils",pageNames:"pgnames"},o=function(r,e){return e===void 0&&(e=":"),r.filter(Boolean).join(e)},E=function(r){var e=r.expression?o(r.expression.map(function(t){return k(t)}),"_and_"):"",a=r.transformations.map(function(t){return N(C(t))});return{expression:e,transformations:o(a,"/")}},T=function(r){return Y[r]||r},k=function(r){var e=Array.isArray(r.characteristic)?o(r.characteristic.map(T)):T(r.characteristic),a=F[r.operator],t=isNaN(r.value)?"!"+r.value+"!":r.value;return o([e,a,t],"_")},H=function(r){if(!r||!r.if||!r.if.expression)return"";var e=E(r.if),a=r.else?E(r.else):null,t=o(["if_"+e.expression,e.transformations],"/"),i=a?o(["if_else",a.transformations],"/"):"";return[o([t,i,"if_end"],"/")]},W=function(r){var e=typeof r=="string";if(!r||!e&&!r.name)return"";if(e||!r.value)return"e_"+(r.name||r);var a=Array.isArray(r.value)?r.value.join(":"):r.value,t=o([r.name,a]);return"e_"+t},b="$",X={integer:"to_i",float:"to_f"},O="((\\|\\||>=|<=|&&|!=|>|=|<|/|-|\\+|\\*|\\^)(?=[ _]))",$=function(r){var e=new RegExp(O,"g");return r.replace(e,function(a){return z[a]})},K=function(r){var e=new RegExp(G,"g");return r.replace(e,function(a,t,i){return r[i-1]===b?a:P[a]})},m=function(r){return isNaN(r)?A(r):r},A=function(r){if(!r)return"";var e=$(r),a=K(e);return a.replace(/[ _]+/g,"_")},J=function(r){var e=new RegExp(O,"g");return e.test(r)},Q=function(r){if(!r||r.length===0)return"";var e=typeof r=="string"?r:r.join(":");return"fl_"+e},Z=function(r){return r},j=function(r){if(!r||!r.expression)return"";var e=Array.isArray(r.expression)?o(r.expression):r.expression,a=J(e),t=A(e),i=X[r.formatAs]||"",n=t&&!a?"!"+t+"!":t;return o([n,i],"_")},R=function(r){var e=""+b+r.name,a=r.value;isNaN(r.value)&&(Array.isArray(r.value)?a=o(r.value):a=j(r.value));var t=o([M[r.assignFrom],a],":");return t?o([e,t],"_"):""},rr=function(r){return r?Array.isArray(r)?o(r.map(function(e){return R(e)}),","):R(r):""},er=function(r){var e=typeof r=="object";if(!r||e&&!r.min)return"";var a=e?o([r.min,r.max],"-"):r;return"fps_"+a},ar=function(r){if(!r)return"";var e=r.start?"so_"+r.start:"",a=r.end?"eo_"+r.end:"",t=r.duration?"du_"+r.duration:"";return[e,a,t].filter(Boolean).join(",")},tr=function(r){var e=r.type,a=r.width,t=r.height,i=r.aspectRatio,n=a?"w_"+m(a):"",u=t?"h_"+m(t):"",s=e?"c_"+e:"",f=i?"ar_"+m(i):"";return[s,n,u,f].filter(Boolean).join()},ir=function(r){var e=r.type,a=e===void 0?"solid":e,t=r.color,i=t===void 0?"black":t,n=r.width;if(!n)return"";var u=isNaN(n)?A(n):n+"px";return"bo_"+u+"_"+a+"_"+i},nr=function(r){var e=r.x,a=r.y,t=e?"x_"+m(e):"",i=a?"y_"+m(a):"";return[t,i].filter(Boolean).join()},or=function(r){var e=r.resize||r.width||r.height||r.aspectRatio;return e?tr(r.resize||{width:r.width,height:r.height,type:r.crop,aspectRatio:r.aspectRatio}):""},ur=function(r){if(!r.border)return"";var e=typeof r.border=="string"?"bo_"+r.border:ir(r.border);return e},sr=function(r){return!r.x&&!r.y&&!r.position?"":nr(r.position||{x:r.x,y:r.y})},w=function(r){var e=[];e.push(rr(r.variables)),e.push(or(r)),e.push(ur(r)),e.push(sr(r)),e.push(er(r.fps)),e.push(ar(r.offset));for(var a in r){var t=r[a],i=B[a];if(!(!i||!t)){var n=L.includes(a);e.push(i+"_"+(n?m(t):t))}}return e.push(W(r.effect)),e.push(Q(r.flags)),e.push(Z(r.rawTransformation)),e.push(H(r.condition)),e.filter(Boolean)},C=function(r){var e=w(r),a=r.transformation||r.chaining;return a&&Array.isArray(a)&&a.forEach(function(t){var i=w(t);i.length>0&&e.push(i)}),e.filter(Boolean)},N=function(r){return r.reduce(function(e,a){var t=Array.isArray(a),i=t?"/":",";return""+e+(e?i:"")+a.toString()},"")},g=globalThis&&globalThis.__assign||function(){return g=Object.assign||function(r){for(var e,a=1,t=arguments.length;a<t;a++){e=arguments[a];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},g.apply(this,arguments)},fr=["cloudinary-a.akamaihd.net","res.cloudinary.com"],cr=/^.+\.cloudinary\.com\/(?:[^\/]+\/)(?:(image|video|raw)\/)?(?:(upload|fetch|private|authenticated|sprite|facebook|twitter|youtube|vimeo)\/)?(?:(?:[^_/]+_[^,/]+,?)*\/)?(?:v(\d+|\w{1,2})\/)?([^\.^\s]+)(?:\.(.+))?$/,vr=function(r){if(!r)return"";var e=cr.exec(r);return e&&e.length>2?e[e.length-2]:r},dr=function(r){if(!r)return"";var e=r.indexOf("s--")===0&&r.endsWith("--");return e?r:"s--"+r+"--"},lr=function(r){return!r.match(/^v[0-9]+/)&&!r.match(/^https?:\//)},S=function(r){return encodeURIComponent(r).replace(/%3A/g,":").replace(/%2F/g,"/")},mr=function(r,e){var a=e.forceVersion,t=a===void 0?!1:a,i=e.version,n=i===void 0?1:i,u=lr(r)&&t;return u?"v"+n:""},pr=function(r,e){var a=e.cdnSubdomain,t=a===void 0?!1:a,i=e.cname;return i?t?"a"+r+".":"":"res"+(t?"-"+r:"")},gr=function(r,e){var a=e.cloudName,t=e.privateCdn,i=t===void 0?!1:t,n=e.cdnSubdomain,u=n===void 0?!1:n,s=e.secureDistribution,f=e.cname,d=e.secure,l=d===void 0?!0:d,c=l&&s&&!fr.includes(s),p="http"+(l?"s":"")+"://",U=i&&!c?a+"-":"",V=i?"":"/"+a,D=c?"":pr(r,{cdnSubdomain:u,cname:f}),q=c?s:f||".cloudinary.com";return""+p+U+D+q+V},hr=function(r){var e=r.resourceType,a=e===void 0?h.IMAGE:e,t=r.storageType,i=t===void 0?x.UPLOAD:t,n=r.urlSuffix,u=r.useRootPath,s=r.shortern,f=a===h.IMAGE&&i===x.UPLOAD,d=u&&!f,l=s&&f,c=a+"/"+i;if(d)throw new Error("Root path only supported for image/upload");if(u)return l?"iu":"";if(n){var p=_[c];if(p)return p;throw new Error("URL Suffix only supported for "+Object.keys(_).join(", "))}return c},I=function(r){return r&&!!r.match(/^https?:\//)},yr=function(r,e){var a=e.urlSuffix,t=a===void 0?"":a;if(I(r))return S(r);var i=[r,t].filter(Boolean).join("/");return S(i)},Ar=function(r,e,a){if(e===void 0&&(e={cloudName:""}),!e.cloudName)throw Error("cloudName is required!");var t=I(r)?vr(r):r,i=mr(t,e),n=gr(t,e),u=dr(e.signature),s=hr(e),f=yr(t,{urlSuffix:e.urlSuffix}),d=a.fetchFormat||a.format||"auto",l=g(g({quality:"auto"},a),{format:d}),c=N(C(l));return[n,s,u,c,i,f].filter(Boolean).join("/").replace(" ","%20")},v=globalThis&&globalThis.__assign||function(){return v=Object.assign||function(r){for(var e,a=1,t=arguments.length;a<t;a++){e=arguments[a];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},v.apply(this,arguments)},y={},_r=function(r){return y=v(v({},y),r)},xr=function(r,e){var a=e.cloud,t=a===void 0?{}:a,i=e.transformations,n=i===void 0?{}:i,u=v(v({},y),t);return Ar(r,u,n)},Er=function(r,e){var a=e.cloud,t=a===void 0?{}:a,i=e.transformations,n=i===void 0?{}:i;return xr(r,{cloud:v(v({},t),{resourceType:h.IMAGE}),transformations:n})};export{Er as b,_r as s};
